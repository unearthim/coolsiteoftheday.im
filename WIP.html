<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cool Site of the Day Monument</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'mono': ['Space Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="importmap">
    {
      "imports": {
        "react": "https://esm.sh/react@18?dev",
        "react-dom/client": "https://esm.sh/react-dom@18/client?dev",
        "lucide-react": "https://esm.sh/lucide-react@0.263.1?dev"
      }
    }
    </script>
    
    <style>
        body {
            background: #0a0e27;
            background-attachment: fixed;
            overflow-x: hidden;
        }
        
        /* --- SUBTLE Background Animation (Restored) --- */
        .ambient-light {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: -1;
            background-image: 
                radial-gradient(at 20% 30%, rgba(88, 28, 135, 0.2) 0px, transparent 50%),
                radial-gradient(at 80% 70%, rgba(37, 99, 235, 0.2) 0px, transparent 50%),
                radial-gradient(at 50% 50%, rgba(109, 40, 217, 0.15) 0px, transparent 50%);
            animation: ambient-drift 10s ease-in-out infinite alternate;
        }

        @keyframes ambient-drift {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
        
        /* --- SUBTLE Pulse (Restored) --- */
        @keyframes cosmic-pulse {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(139, 92, 246, 0.15),
                            0 0 60px rgba(139, 92, 246, 0.05),
                            inset 0 0 40px rgba(139, 92, 246, 0.05);
                border-color: rgba(139, 92, 246, 0.3);
            }
            50% { 
                box-shadow: 0 0 50px rgba(139, 92, 246, 0.25),
                            0 0 90px rgba(139, 92, 246, 0.1),
                            inset 0 0 60px rgba(139, 92, 246, 0.1);
                border-color: rgba(139, 92, 246, 0.5);
            }
        }
        
        .cosmic-pulse {
            animation: cosmic-pulse 4s ease-in-out infinite;
        }

        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
            100% { transform: translateY(0px); }
        }

        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        /* --- SUBTLE Glass Shimmer (Restored) --- */
        @keyframes glass-shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        
        .glass-morphism {
            background: rgba(15, 23, 42, 0.4);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            /* The shimmer gradient overlay */
            background-image: linear-gradient(
                110deg,
                transparent 0%,
                transparent 40%,
                rgba(255, 255, 255, 0.03) 50%,
                transparent 60%,
                transparent 100%
            );
            background-size: 200% 100%;
            animation: glass-shimmer 8s linear infinite;
        }
        
        .text-glow {
            text-shadow: 0 0 30px rgba(139, 92, 246, 0.6),
                         0 0 60px rgba(139, 92, 246, 0.4);
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fade-in 0.8s ease-out;
        }
        
        .site-preview-container {
            width: 100%;
            height: calc(100vh - 280px);
            min-height: 600px;
            background: #0f0f0f;
        }
    </style>
</head>
<body class="min-h-screen text-slate-100 antialiased relative">
    
    <div class="ambient-light"></div>

    <div id="root"></div>

    <script type="text/babel" data-type="module">
        import React, { useState, useEffect } from 'react';
        import { createRoot } from 'react-dom/client';
        import { 
            Calendar, 
            ExternalLink,
            History,
            Sparkles,
            Maximize2,
            Minimize2,
            ArrowUpRight
        } from 'lucide-react';

        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { 
            getAuth, 
            signInAnonymously, 
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { 
            getFirestore, 
            collection, 
            onSnapshot
        } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- SEO Component ---
        const SeoHeader = () => {
            useEffect(() => {
                document.title = "Cool Site of the Day Monument | coolsiteoftheday.im";
                
                const metaTags = [
                    { name: "description", content: "A daily digital monument curating the coolest sites on the web. One site, every day. A tribute to the early web." },
                    { name: "keywords", content: "cool sites, daily link, web history, internet monument, microblog" },
                    { property: "og:title", content: "Cool Site of the Day Monument" },
                    { property: "og:description", content: "A daily digital monument curating the coolest sites on the web." },
                    { property: "og:type", content: "website" }
                ];

                metaTags.forEach(tag => {
                    let element;
                    if (tag.name) {
                        element = document.querySelector(`meta[name="${tag.name}"]`);
                    } else if (tag.property) {
                        element = document.querySelector(`meta[property="${tag.property}"]`);
                    }

                    if (!element) {
                        element = document.createElement('meta');
                        if (tag.name) element.setAttribute('name', tag.name);
                        if (tag.property) element.setAttribute('property', tag.property);
                        document.head.appendChild(element);
                    }
                    element.setAttribute('content', tag.content);
                });
            }, []);

            return null;
        };

        // --- Firebase Configuration ---
        const firebaseConfig = {
            apiKey: "AIzaSyAEU3QcCzu4ZmwJpHhogu1hMpyRp2swUz8",
            authDomain: "jojo-4b593.firebaseapp.com",
            projectId: "jojo-4b593",
            storageBucket: "jojo-4b593.firebasestorage.app",
            messagingSenderId: "353107431611",
            appId: "1:353107431611:web:e727900cec519d1144599e",
            measurementId: "G-S3LZY800T3"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const appId = 'coolsite-monument-v1';

        // --- Helper: Get Microlink URL ---
        const getScreenshotUrl = (url) => {
            if (!url) return '';
            const encodedUrl = encodeURIComponent(url);
            return `https://api.microlink.io/?url=${encodedUrl}&screenshot=true&meta=false&embed=screenshot.url&viewport.width=1280&viewport.height=800`;
        };

        // --- Archive Entry Component ---
        const ArchiveEntry = ({ post }) => {
            return (
                <div className="glass-morphism rounded-xl border border-slate-700/30 hover:border-purple-500/40 p-6 transition-all duration-300 group">
                    <div className="flex justify-between items-start mb-3">
                        <time className="text-sm font-mono text-slate-500">
                            {new Date(post.dateString).toLocaleDateString('en-US', { 
                                year: 'numeric', 
                                month: 'short', 
                                day: 'numeric',
                                timeZone: 'UTC' 
                            })}
                        </time>
                    </div>
                    
                    <h3 className="text-lg font-semibold text-slate-200 group-hover:text-purple-300 transition-colors mb-2">
                        <a 
                            href={post.url} 
                            target="_blank" 
                            rel="noopener noreferrer"
                            className="flex items-center"
                        >
                            {post.title}
                            <ExternalLink className="w-4 h-4 ml-2 opacity-50" />
                        </a>
                    </h3>
                    
                    {post.content && (
                        <p className="text-slate-400 text-sm leading-relaxed">{post.content}</p>
                    )}
                </div>
            );
        };

        // --- Main App Component ---
        function App() {
            const [user, setUser] = useState(null);
            const [posts, setPosts] = useState([]);
            const [loading, setLoading] = useState(true);
            const [isFullView, setIsFullView] = useState(false);

            // --- Auth & Data Init ---
            useEffect(() => {
                const initAuth = async () => {
                    try {
                        await signInAnonymously(auth);
                    } catch (err) {
                        console.error("Auth failed:", err);
                    }
                };

                initAuth();
                const unsubscribe = onAuthStateChanged(auth, (currentUser) => {
                    setUser(currentUser);
                });
                return () => unsubscribe();
            }, []);

            const getTodayString = () => {
                const d = new Date();
                const year = d.getFullYear();
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const day = String(d.getDate()).padStart(2, '0');
                return `${year}-${month}-${day}`;
            };

            // --- Fetch Posts ---
            useEffect(() => {
                if (!user) return;

                const collectionRef = collection(db, 'artifacts', appId, 'public', 'data', 'daily_sites');
                
                const unsubscribe = onSnapshot(collectionRef, (snapshot) => {
                    const fetchedPosts = snapshot.docs.map(doc => ({
                        id: doc.id,
                        ...doc.data()
                    }));
                    
                    const sortedPosts = fetchedPosts.sort((a, b) => {
                        const dateA = new Date(a.dateString || 0);
                        const dateB = new Date(b.dateString || 0);
                        return dateB - dateA;
                    });

                    setPosts(sortedPosts);
                    setLoading(false);
                }, (err) => {
                    console.error("Firestore error:", err);
                    setLoading(false);
                });

                return () => unsubscribe();
            }, [user]);

            const todayString = getTodayString();
            const todaysPost = posts.find(p => p.dateString === todayString);
            const pastPosts = posts.filter(p => p.dateString !== todayString);

            return (
                <div className="min-h-screen flex flex-col relative z-10">
                    <SeoHeader />

                    {loading ? (
                        <div className="flex-grow flex items-center justify-center">
                            <div className="text-slate-500 text-lg font-mono animate-pulse">Loading monument...</div>
                        </div>
                    ) : todaysPost ? (
                        <>
                            {/* TODAY'S MONUMENT */}
                            <div className="flex-grow flex flex-col p-6 lg:p-12 animate-fade-in">
                                
                                {/* Header Metadata */}
                                <header className="w-full flex flex-col lg:flex-row justify-between items-start lg:items-end pb-6 mb-6 border-b border-slate-700/50">
                                    <div className="mb-6 lg:mb-0">
                                        <div className="flex items-center space-x-4 mb-3 float-animation">
                                            <div className="relative">
                                                <div className="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl blur-xl opacity-50"></div>
                                                <div className="relative bg-gradient-to-br from-purple-600 to-blue-600 p-3 rounded-2xl">
                                                    <Sparkles className="w-7 h-7 text-white" />
                                                </div>
                                            </div>
                                            <h1 className="text-4xl lg:text-5xl font-black tracking-tight uppercase text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-blue-300 text-glow">
                                                Cool Site of the Day
                                            </h1>
                                        </div>
                                        <p className="text-slate-400 italic text-sm lg:text-base max-w-xl">
                                            {todaysPost.content || "Today's featured digital monument"}
                                        </p>
                                    </div>
                                    
                                    <div className="text-left lg:text-right flex flex-col items-start lg:items-end">
                                        <div className="flex items-center space-x-2 text-purple-400 mb-1 font-mono text-sm tracking-wider uppercase opacity-70">
                                            <Calendar className="w-4 h-4" />
                                            <time>
                                                {new Date(todaysPost.dateString).toLocaleDateString('en-US', { 
                                                    year: 'numeric', 
                                                    month: 'long', 
                                                    day: 'numeric',
                                                    timeZone: 'UTC' 
                                                })}
                                            </time>
                                        </div>
                                        
                                        {/* THE NEW APPETIZING LINK */}
                                        <a 
                                            href={todaysPost.url} 
                                            target="_blank" 
                                            rel="noopener noreferrer"
                                            className="group flex items-center space-x-4 lg:space-x-6 py-2 transition-all duration-300"
                                        >
                                            <span className="text-3xl lg:text-5xl font-black tracking-tighter text-slate-100 group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-purple-300 group-hover:to-blue-300 transition-all">
                                                {todaysPost.title}
                                            </span>
                                            
                                            {/* The Magnetic Arrow Button */}
                                            <div className="relative flex items-center justify-center w-10 h-10 lg:w-14 lg:h-14 rounded-full border border-white/10 bg-white/5 group-hover:bg-purple-500/20 group-hover:border-purple-500/50 transition-all duration-300 group-hover:scale-110">
                                                <ArrowUpRight className="w-5 h-5 lg:w-7 lg:h-7 text-slate-400 group-hover:text-white group-hover:rotate-45 transition-all duration-300" />
                                            </div>
                                        </a>
                                    </div>
                                </header>

                                {/* Main Featured Screenshot */}
                                <main className="flex-grow w-full flex items-center justify-center">
                                    {/* Frame: Subtle Breathing Pulse */}
                                    <div className="site-preview-container relative rounded-xl overflow-hidden border-2 border-purple-500/30 cosmic-pulse bg-slate-900 group shadow-2xl">
                                        
                                        {/* Loading / Empty State underneath */}
                                        <div className="absolute inset-0 flex items-center justify-center text-slate-700 z-0">
                                            <span className="font-mono text-xs uppercase tracking-widest">Rendering Digital Artifact...</span>
                                        </div>

                                        {/* Screenshot Image */}
                                        <img 
                                            src={getScreenshotUrl(todaysPost.url)}
                                            alt={`Screenshot of ${todaysPost.title}`}
                                            className={`relative z-10 w-full h-full object-top transition-all duration-700 ease-in-out ${
                                                isFullView ? 'object-contain' : 'object-cover'
                                            }`}
                                            loading="eager"
                                        />
                                        
                                        {/* View Toggle Button */}
                                        <button 
                                            onClick={(e) => {
                                                e.preventDefault();
                                                setIsFullView(!isFullView);
                                            }}
                                            className="absolute bottom-4 right-4 z-30 flex items-center gap-2 px-4 py-2 bg-black/60 hover:bg-black/80 hover:scale-105 active:scale-95 backdrop-blur-md border border-slate-600/50 rounded-full text-xs font-mono text-white transition-all duration-200 shadow-lg cursor-pointer"
                                        >
                                            {isFullView ? (
                                                <>
                                                    <Minimize2 className="w-4 h-4" />
                                                    <span>Fill Frame</span>
                                                </>
                                            ) : (
                                                <>
                                                    <Maximize2 className="w-4 h-4" />
                                                    <span>Fit Full Page</span>
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </main>
                            </div>

                            {/* ARCHIVE SECTION */}
                            {pastPosts.length > 0 && (
                                <section className="w-full px-6 lg:px-12 py-12 border-t border-slate-800/50">
                                    <div className="max-w-6xl mx-auto">
                                        <div className="flex items-center space-x-3 mb-8">
                                            <History className="w-5 h-5 text-purple-400" />
                                            <h2 className="text-2xl font-bold text-slate-300 uppercase tracking-wide">
                                                Archive
                                            </h2>
                                            <span className="text-slate-600 font-mono text-sm">
                                                ({pastPosts.length})
                                            </span>
                                        </div>
                                        
                                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                                            {pastPosts.map((post) => (
                                                <ArchiveEntry key={post.id} post={post} />
                                            ))}
                                        </div>
                                    </div>
                                </section>
                            )}
                        </>
                    ) : (
                        <div className="flex-grow flex items-center justify-center p-12">
                            <div className="text-center float-animation">
                                <Sparkles className="w-20 h-20 mx-auto mb-6 text-purple-500/20" />
                                <h2 className="text-3xl font-bold text-slate-400 mb-3">No Monument Yet</h2>
                                <p className="text-slate-500">The chronicle begins soon...</p>
                            </div>
                        </div>
                    )}

                    {/* FOOTER */}
                    <footer className="w-full px-6 py-8 border-t border-slate-800/50 text-center">
                        <p className="text-slate-600 text-sm font-mono mb-2">
                            Â© {new Date().getFullYear()} coolsiteoftheday.im
                        </p>
                        <p className="text-slate-700 text-xs">
                            A digital artifact unearthed and preserved by{' '}
                            <a 
                                href="https://unearth.im" 
                                target="_blank" 
                                rel="noopener noreferrer"
                                className="text-purple-500/60 hover:text-purple-400 transition-colors"
                            >
                                unearth.im
                            </a>
                        </p>
                    </footer>
                </div>
            );
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>