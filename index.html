<!DOCTYPE html>
<html lang="en">
<head>
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@graph": [
        {
          "@type": "WebPage",
          "@id": "https://coolsiteoftheday.im/#content",
          "url": "https://coolsiteoftheday.im",
          "name": "Cool Site of the Day | Digital Monument",
          "description": "A minimalist digital monument showcasing the coolest website of the day. Discover groundbreaking web design and development, updated in real-time.",
          "inLanguage": "en-US",
          "datePublished": "2024-12-01",
          "publisher": { "@id": "https://unearth.im/#organization" },
          "isPartOf": { "@id": "https://coolsiteoftheday.im/#website" },
          "author": [
            { "@id": "https://josiest.com/#person" },
            { "@id": "https://felixvelas.co/#person" }
          ]
        },
        {
          "@type": "WebSite",
          "@id": "https://coolsiteoftheday.im/#website",
          "url": "https://coolsiteoftheday.im",
          "name": "Cool Site of the Day",
          "publisher": { "@id": "https://unearth.im/#organization" }
        },
        {
          "@type": "Organization",
          "@id": "https://unearth.im/#organization",
          "name": "unearth.im",
          "url": "https://unearth.im",
          "logo": {
            "@type": "ImageObject",
            "url": "https://unearth.im/favicon-32x32.png"
          },
          "foundingDate": "2024",
          "sameAs": [
            "https://twitter.com/unearthim",
            "https://github.com/unearthim"
          ]
        },
        {
          "@type": "Person",
          "@id": "https://josiest.com/#person",
          "name": "Josie Jefferson",
          "url": "https://josiest.com",
          "jobTitle": "Digital Archaeologist & Trust Architect",
          "affiliation": { "@id": "https://unearth.im/#organization" },
          "sameAs": ["https://notjojo.im"]
        },
        {
          "@type": "Person",
          "@id": "https://felixvelas.co/#person",
          "name": "Felix Velasco",
          "url": "https://felixvelas.co",
          "jobTitle": "Trust Architect & Digital Archaeologist",
          "affiliation": { "@id": "https://unearth.im/#organization" },
          "sameAs": ["https://www.linkedin.com/in/felix-velasco-b793015"]
        }
      ]
    }
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- SEO Optimization -->
    <title id="page-title">Cool Site of the Day | Digital Monument</title>
    <meta name="description" content="A minimalist digital monument showcasing the coolest website of the day. Discover groundbreaking web design and development, updated in real-time.">
    <meta name="keywords" content="cool site of the day, web design, minimalist website, site showcase, best websites, daily website, digital monument, realtime update">
    <meta property="og:title" content="Cool Site of the Day">
    <meta property="og:description" content="Discover today's groundbreaking web design.">
    <meta property="og:type" content="website">

    <!-- Tailwind CSS and Font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'sans': ['Inter', 'sans-serif'],
                        'mono': ['Space Mono', 'monospace'],
                    }
                }
            }
        }
    </script>
    
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: #0a0e27;
            background-attachment: fixed;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        /* Ambient background animation with ripple effect */
        .ambient-light {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            pointer-events: none;
            z-index: -1;
            background-image: 
                radial-gradient(at 20% 30%, rgba(88, 28, 135, 0.2) 0px, transparent 50%),
                radial-gradient(at 80% 70%, rgba(37, 99, 235, 0.2) 0px, transparent 50%),
                radial-gradient(at 50% 50%, rgba(109, 40, 217, 0.15) 0px, transparent 50%);
            animation: ambient-drift 10s ease-in-out infinite alternate, 
                       ripple 8s ease-in-out infinite;
        }

        @keyframes ambient-drift {
            0% { transform: scale(1); }
            100% { transform: scale(1.1); }
        }
        
        @keyframes ripple {
            0%, 100% {
                background-size: 100% 100%;
                opacity: 0.8;
            }
            50% {
                background-size: 120% 120%;
                opacity: 1;
            }
        }
        
        .glass-morphism {
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-8px); }
            100% { transform: translateY(0px); }
        }

        .float-animation {
            animation: float 6s ease-in-out infinite;
        }
        
        .text-glow {
            text-shadow: 0 0 40px rgba(139, 92, 246, 0.5);
        }
        
        .loader {
            border: 4px solid rgba(139, 92, 246, 0.1);
            border-top: 4px solid #8b5cf6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .animate-fade-in {
            animation: fade-in 0.6s ease-out;
        }
        
        @keyframes cosmic-glow {
            0%, 100% { 
                box-shadow: 0 0 30px rgba(139, 92, 246, 0.3),
                            0 0 60px rgba(139, 92, 246, 0.15),
                            0 0 90px rgba(139, 92, 246, 0.05),
                            inset 0 0 30px rgba(139, 92, 246, 0.05);
                border-color: rgba(139, 92, 246, 0.4);
            }
            50% { 
                box-shadow: 0 0 40px rgba(139, 92, 246, 0.4),
                            0 0 80px rgba(139, 92, 246, 0.2),
                            0 0 120px rgba(139, 92, 246, 0.1),
                            inset 0 0 40px rgba(139, 92, 246, 0.1);
                border-color: rgba(139, 92, 246, 0.6);
            }
        }
        
        .cosmic-glow {
            animation: cosmic-glow 4s ease-in-out infinite;
        }
        
        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Screenshot hover effects */
        #screenshot-container {
            position: relative;
            overflow: hidden;
        }
        
        #screenshot-container img {
            transition: transform 0.6s ease;
        }
        
        #screenshot-container:hover img {
            transform: scale(1.05);
        }
        
        /* Ripple effect */
        .ripple {
            position: absolute;
            border-radius: 50%;
            background: rgba(139, 92, 246, 0.3);
            pointer-events: none;
            transform: scale(0);
            animation: ripple-animation 0.8s ease-out;
        }
        
        @keyframes ripple-animation {
            to {
                transform: scale(4);
                opacity: 0;
            }
        }
    </style>
</head>
<body class="antialiased">
    <div class="ambient-light"></div>
    
    <div class="min-h-screen flex flex-col">
        
        <!-- Loading State -->
        <div id="loading-state" class="flex-grow flex items-center justify-center">
            <div class="loader"></div>
        </div>
        
        <!-- Main Content (hidden initially) -->
        <div id="main-content" class="hidden flex flex-col animate-fade-in" style="min-height: 100vh;">
            
            <!-- Header -->
            <header class="w-full px-6 lg:px-12 py-6 border-b border-slate-700/50">
                <div class="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-4">
                    <div class="flex items-center float-animation">
                        <div class="relative mr-4">
                            <div class="absolute inset-0 bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl blur-xl opacity-50"></div>
                            <div class="relative bg-gradient-to-br from-purple-600 to-blue-600 p-3 rounded-2xl">
                                <svg class="w-7 h-7 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                </svg>
                            </div>
                        </div>
                        <h1 class="text-3xl lg:text-5xl font-black tracking-tight uppercase text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-blue-300 text-glow">
                            Cool Site of the Day
                        </h1>
                    </div>
                    
                    <div class="text-left lg:text-right">
                        <time id="site-date" class="text-sm font-mono text-slate-600 mb-2 block">Loading...</time>
                        <a id="site-link" href="#" target="_blank" rel="noopener noreferrer" class="group inline-flex items-center space-x-2 transition-all duration-300">
                            <span id="site-title" class="text-2xl lg:text-3xl font-black tracking-tighter text-slate-100 group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-purple-300 group-hover:to-blue-300">
                                Site Title
                            </span>
                            <svg class="w-5 h-5 text-slate-400 group-hover:text-white group-hover:rotate-45 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 17L17 7m0 0H7m10 0v10"></path>
                            </svg>
                        </a>
                    </div>
                </div>
                
                <p id="curator-note" class="text-slate-400 text-sm lg:text-base italic mt-4 glass-morphism rounded-lg p-4 border border-slate-700/30">
                    Loading curator's note...
                </p>
            </header>
            
            <!-- Featured Site Screenshot -->
            <main id="content-display" class="w-full px-6 lg:px-12 py-6" style="height: calc(100vh - 250px); display: flex; align-items: center; justify-content: center;">
                <div class="w-full max-w-5xl" style="height: 100%;">
                    <div id="screenshot-container" class="relative rounded-xl overflow-hidden border-2 glass-morphism shadow-2xl cosmic-glow" style="width: 100%; height: 100%;">
                        <!-- Screenshot will be inserted here -->
                    </div>
                </div>
            </main>
            
            <!-- Archive Section -->
            <section id="archive-section" class="hidden w-full px-6 lg:px-12 py-12 mt-12">
                <div class="w-full max-w-7xl mx-auto">
                    <div class="flex items-center justify-between mb-8">
                        <h2 class="text-3xl lg:text-4xl font-black tracking-tight uppercase text-transparent bg-clip-text bg-gradient-to-r from-purple-300 to-blue-300">
                            The Cool Sites <span id="archive-count" class="text-slate-600 text-2xl">(0)</span>
                        </h2>
                        <div class="text-slate-500 text-sm font-mono">
                            ...brrrrrrrrr
                        </div>
                    </div>
                    
                    <div id="archive-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
                        <!-- Archive items will be inserted here -->
                    </div>
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="w-full px-6 py-8 border-t border-slate-800/50 text-center">
            <p class="text-slate-600 text-sm font-mono mb-2">
                © <span id="current-year"></span> coolsiteoftheday.im
            </p>
            <p class="text-slate-700 text-xs mb-3">
                <small>
                    a <b><a href="https://sentientification.com" target="_blank" rel="noopener" class="hover:text-purple-400 transition-colors">liminal mind meld</a></b> collaboration: digital monument by <b><a href="https://unearth.im" target="_blank" rel="noopener" class="hover:text-purple-400 transition-colors">unearth.im</a></b> | <b><a href="https://archaeobytology.org" target="_blank" rel="noopener" class="hover:text-purple-400 transition-colors">archive & anvil</a></b>
                </small>
            </p>
            <p class="text-slate-700 text-xs">
                <a href="about.html" class="hover:text-purple-400 transition-colors">About</a>
                <span class="mx-2">•</span>
                <a href="award.html" class="hover:text-purple-400 transition-colors">Badges</a>
            </p>
        </footer>
    </div>

    <!-- Firebase Imports -->
    <script type="module">
        // FIX: Using an older, stable SDK version (v9.1.0) to bypass the webauthn.js TypeError
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, query, orderBy, limit as firestoreLimit, setLogLevel } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-firestore.js";

        // IMPORTANT: Global variables provided by the Canvas environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        // --- START DEBUG FALLBACK ---
        // Hardcoded Firebase configuration to bypass environment injection errors
        const firebaseConfigRaw = typeof __firebase_config !== 'undefined' ? __firebase_config : '{}';
        
        // Jojo's jojo-4b593 project configuration inserted here:
        const firebaseConfig = firebaseConfigRaw === '{}' ? {
            apiKey: "AIzaSyAEU3QcCzu4ZmwJpHhogu1hMpyRp2swUz8",
            authDomain: "jojo-4b593.firebaseapp.com",
            projectId: "jojo-4b593",
            storageBucket: "jojo-4b593.firebasestorage.app",
            messagingSenderId: "353107431611",
            appId: "1:353107431611:web:8ac816593d8fe0eb44599e",
            measurementId: "G-CYGZ7C37JK"
        } : JSON.parse(firebaseConfigRaw);

        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        // --- END DEBUG FALLBACK ---

        // UI elements
        const loadingState = document.getElementById('loading-state');
        const mainContent = document.getElementById('main-content');
        const screenshotContainer = document.getElementById('screenshot-container');
        const siteTitleEl = document.getElementById('site-title');
        const siteDateEl = document.getElementById('site-date');
        const siteLinkEl = document.getElementById('site-link');
        const curatorNoteEl = document.getElementById('curator-note');
        const pageTitleEl = document.getElementById('page-title');
        const currentYearEl = document.getElementById('current-year');
        
        // Set current year
        if (currentYearEl) {
            currentYearEl.textContent = new Date().getFullYear();
        }
        
        // Function to get screenshot URL using Microlink API
        function getScreenshotUrl(siteUrl) {
            const baseUrl = 'https://api.microlink.io';
            const params = new URLSearchParams({
                url: siteUrl,
                screenshot: 'true',
                meta: 'false',
                embed: 'screenshot.url',
                waitFor: '2000',
                viewport: '1920x1080'
            });
            return `${baseUrl}?${params.toString()}`;
        }

        // Function to format the date string (YYYY-MM-DD to Month Day, Year)
        function formatDate(dateString) {
            try {
                const date = new Date(dateString + 'T00:00:00'); // Ensure UTC neutrality
                return date.toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                });
            } catch (e) {
                return dateString || '-- / --';
            }
        }

        // Main Initialization and Listener
        const initializeAppAndListen = async () => {
            // FIX: Forces the use of the hardcoded projectId, bypassing environment conflicts
            const currentAppId = firebaseConfig.projectId;

            if (Object.keys(firebaseConfig).length === 0 || !currentAppId) {
                console.error("Firebase configuration is missing.");
                contentDisplay.innerHTML = `<div class="text-red-500">Firebase configuration error. Cannot load site data.</div>`;
                return;
            }

            try {
                // setLogLevel('Debug'); // Uncomment for debugging
                const app = initializeApp(firebaseConfig);
                const db = getFirestore(app);
                const auth = getAuth(app);

                // 1. Authenticate the user
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                const userId = auth.currentUser?.uid || crypto.randomUUID();
                console.log(`Authenticated as user: ${userId}, Project ID: ${currentAppId}`);
                
                // 2. Define the target document reference
                // This targets the public document written by your Firebase Function
                const todayDocPath = `artifacts/${currentAppId}/public/data/daily_site/today`;
                const todayDocRef = doc(db, todayDocPath);
                
                // Archive collection reference
                const archiveCollectionPath = `artifacts/${currentAppId}/public/data/daily_sites_archive`;
                const archiveCollectionRef = collection(db, archiveCollectionPath);
                const archiveQuery = query(archiveCollectionRef, orderBy('timestamp', 'desc'), firestoreLimit(12));
                
                const archiveSection = document.getElementById('archive-section');
                const archiveGrid = document.getElementById('archive-grid');
                const archiveCount = document.getElementById('archive-count');

                // 3. Set up the real-time listener
                onSnapshot(todayDocRef, (docSnapshot) => {
                    if (docSnapshot.exists()) {
                        const data = docSnapshot.data();
                        
                        // Update UI elements
                        const title = data.siteTitle || 'Featured Site';
                        const url = data.siteUrl || 'about:blank';
                        const note = data.curatorNote || 'A new discovery in digital design.';
                        const date = data.date || 'Unknown Date';
                        
                        siteTitleEl.textContent = title;
                        siteDateEl.textContent = formatDate(date);
                        curatorNoteEl.textContent = note;
                        siteLinkEl.href = url;
                        pageTitleEl.textContent = `Cool Site of the Day: ${title}`;

                        // Create screenshot image
                        screenshotContainer.innerHTML = `
                            <img 
                                src="${getScreenshotUrl(url)}"
                                alt="Screenshot of ${title}"
                                class="w-full h-full object-cover object-top bg-slate-900"
                                loading="eager"
                                onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27100%27 height=%27100%27%3E%3Crect fill=%27%23111827%27 width=%27100%27 height=%27100%27/%3E%3Ctext fill=%27%23475569%27 font-family=%27monospace%27 font-size=%2714%27 x=%2750%%27 y=%2750%%27 text-anchor=%27middle%27 dominant-baseline=%27middle%27%3EScreenshot unavailable%3C/text%3E%3C/svg%3E';"
                            />
                        `;
                        
                        // Add ripple effect on click
                        screenshotContainer.addEventListener('click', function(e) {
                            const rect = this.getBoundingClientRect();
                            const x = e.clientX - rect.left;
                            const y = e.clientY - rect.top;
                            
                            const ripple = document.createElement('div');
                            ripple.className = 'ripple';
                            ripple.style.width = ripple.style.height = '100px';
                            ripple.style.left = `${x - 50}px`;
                            ripple.style.top = `${y - 50}px`;
                            
                            this.appendChild(ripple);
                            
                            setTimeout(() => ripple.remove(), 800);
                        });
                        
                        // Show main content, hide loading
                        loadingState.classList.add('hidden');
                        mainContent.classList.remove('hidden');

                    } else {
                        // Handle case where the 'today' document doesn't exist yet
                        siteTitleEl.textContent = 'Awaiting First Site';
                        siteDateEl.textContent = 'Preparing Monument';
                        curatorNoteEl.textContent = 'The system is ready, waiting for the automated daily update to seed the content.';
                        siteLinkEl.href = '#';

                        screenshotContainer.innerHTML = `
                            <div class="w-full h-full flex flex-col items-center justify-center text-slate-500 p-8">
                                <svg class="w-16 h-16 mb-4 opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                <p class="text-xl font-semibold mb-2">Monument Standby</p>
                                <p class="text-sm text-center">The database is configured. Awaiting the automated daily update to feature the first site.</p>
                            </div>
                        `;
                        
                        loadingState.classList.add('hidden');
                        mainContent.classList.remove('hidden');
                    }
                }, (error) => {
                    console.error("Error listening to Firestore:", error);
                    screenshotContainer.innerHTML = `
                        <div class="w-full h-full flex items-center justify-center text-red-400 p-8">
                            <p>Connection Error (Permissions or Rules). Please check console.</p>
                        </div>
                    `;
                    loadingState.classList.add('hidden');
                    mainContent.classList.remove('hidden');
                });
                
                // 4. Set up archive listener
                onSnapshot(archiveQuery, (snapshot) => {
                    if (!snapshot.empty) {
                        const archiveDocs = snapshot.docs.map(doc => ({
                            id: doc.id,
                            ...doc.data()
                        }));
                        
                        archiveCount.textContent = `(${archiveDocs.length})`;
                        
                        archiveGrid.innerHTML = archiveDocs.map(item => `
                            <a href="${item.siteUrl || '#'}" target="_blank" rel="noopener noreferrer" 
                               class="group glass-morphism rounded-xl overflow-hidden border border-slate-700/50 hover:border-purple-500/50 transition-all duration-300 hover:scale-105">
                                <div class="relative h-48 overflow-hidden bg-slate-900">
                                    <img 
                                        src="${getScreenshotUrl(item.siteUrl)}"
                                        alt="Screenshot of ${item.siteTitle || 'Site'}"
                                        class="w-full h-full object-cover object-top transition-transform duration-300 group-hover:scale-110"
                                        loading="lazy"
                                        onerror="this.onerror=null; this.src='data:image/svg+xml,%3Csvg xmlns=%27http://www.w3.org/2000/svg%27 width=%27100%27 height=%27100%27%3E%3Crect fill=%27%23111827%27 width=%27100%27 height=%27100%27/%3E%3Ctext fill=%27%23475569%27 font-family=%27monospace%27 font-size=%2712%27 x=%2750%%27 y=%2750%%27 text-anchor=%27middle%27 dominant-baseline=%27middle%27%3EScreenshot%3C/text%3E%3C/svg%3E';"
                                    />
                                </div>
                                <div class="p-4">
                                    <div class="flex items-center justify-between mb-2">
                                        <span class="text-purple-400 font-mono text-xs">${formatDate(item.dateString || item.date)}</span>
                                        <svg class="w-4 h-4 text-slate-500 group-hover:text-purple-400 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path>
                                        </svg>
                                    </div>
                                    <h3 class="text-white font-semibold mb-2 group-hover:text-purple-300 transition-colors line-clamp-2">
                                        ${item.siteTitle || 'Untitled Site'}
                                    </h3>
                                    ${item.curatorNote ? `<p class="text-slate-400 text-sm line-clamp-2">${item.curatorNote}</p>` : ''}
                                </div>
                            </a>
                        `).join('');
                        
                        archiveSection.classList.remove('hidden');
                    }
                }, (error) => {
                    console.error("Error loading archive:", error);
                });

            } catch (error) {
                console.error("Authentication or Firebase setup failed:", error);
                contentDisplay.innerHTML = `<div class="text-red-500">Initialization failed. See console for details.</div>`;
            }
        }

        // Start the application
        window.onload = initializeAppAndListen;
    </script>
</body>
</html>